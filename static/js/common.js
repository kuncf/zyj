var comFun={iosInit:function(e){function n(e){"function"==typeof e&&e()}var o=navigator.userAgent;"undefined"==typeof GameHelper&&(o.indexOf("iPhone")>-1||o.indexOf("iPad")>-1||o.indexOf("iTouch")>-1)&&document.addEventListener?document.addEventListener("GameHelperReady",n,!1):n(e)},init:function(e){var n=navigator.userAgent;"undefined"==typeof GameHelper&&(n.indexOf("iPhone")>-1||n.indexOf("iPad")>-1||n.indexOf("iTouch")>-1)?document.addEventListener&&document.addEventListener("GameHelperReady",function(){comFun.onGameHelperReady(e)},!1):comFun.onGameHelperReady(e)},checkApp:function(e){},onGameHelperReady:function(e){var n=navigator.userAgent;n.indexOf("GameHelper")<0||"undefined"==typeof GameHelper?window.location.href=location.protocol+"//bang.qq.com/app/tool/download":"function"==typeof e&&e()},openNewPageWithSwitch:function(e,n,o){return"undefined"!=typeof GameHelper&&"undefined"!=typeof GameHelper.openNewPageWithSwitch&&e.indexOf("qq.com")>-1?(GameHelper.openNewPageWithSwitch(e,n,o),!1):(window.location.href=e,!1)},openNewPageWithSwitchAndParam:function(e,n,o,t){return"undefined"!=typeof GameHelper&&"undefined"!=typeof GameHelper.openNewPageWithSwitchAndParam?(GameHelper.openNewPageWithSwitchAndParam(e,n,o,t),!1):(window.location.href=e,!1)},openButton:function(e){return"undefined"!=typeof GameHelper&&"undefined"!=typeof GameHelper.openButton?(GameHelper.openButton(e),!1):void 0},openChat:function(e,n){var o={type:10020,param:{groupId:e,groupType:n}};this.openButton(JSON.stringify(o))},addLoadingDom:function(){var e=".loading-more{height: 30px;background: url(//ossweb-img.qq.com/images/bangbang/js/mobile/frozen/img/loadmore.gif) 50% 50% no-repeat;}.ui-loading-wrap{display:-webkit-box;-webkit-box-pack:center;-webkit-box-align:center;text-align:center;height:40px}.ui-loading{width:20px;height:20px;display:block;background:url(//ossweb-img.qq.com/images/bangbang/js/mobile/frozen/img/loading_sprite.png);-webkit-background-size:auto 20px;-webkit-animation:am-rotate 1s steps(12) infinite}.ui-loading-bright{width:37px;height:37px;display:block;background-image:url(//ossweb-img.qq.com/images/bangbang/js/mobile/frozen/img/loading_sprite_white.png);-webkit-background-size:auto 37px;-webkit-animation:am-rotate2 1s steps(12) infinite}.ui-loading-wrap .ui-loading{margin:10px}.ui-loading-block{position:fixed;top:0;left:0;width:100%;height:100%;z-index:9999;display:-webkit-box;-webkit-box-orient:horizontal;-webkit-box-pack:center;-webkit-box-align:center;background:rgba(0,0,0,0.4);display:none;background:transparent}.ui-loading-block .ui-loading-cnt{width:130px;height:110px;display:-webkit-box;-webkit-box-orient:vertical;-webkit-box-align:center;text-align:center;background:rgba(0,0,0,0.65);border-radius:6px;color:#fff;font-size:16px}.ui-loading-block .ui-loading-bright{margin:18px 0 8px}.ui-loading-block.show{display:-webkit-box;display:box}@-webkit-keyframes am-rotate{from{background-position:0 0}to{background-position:-240px 0}}@-webkit-keyframes am-rotate2{from{background-position:0 0}to{background-position:-444px 0}}",n='<div class="ui-loading-block show"><div class="ui-loading-cnt"><i class="ui-loading-bright"></i><p>正在加载中...</p></div></div>';$("head").append('<style type="text/css">'+e+"</style>"),$("body").append(n)},showLoading:function(){$(".ui-loading-block").show()},hideLoading:function(){$(".ui-loading-block").hide()},showLoadingMore:function(e){var n=$(e+" .loading-more");n.show(),n.length&&0!=n.length||($(e).prepend('<div class="loading-more"></div>'),n.show())},hideLoadingMore:function(e,n){if(n)var o=setTimeout(function(){$(e+" .loading-more").hide(),clearTimeout(o)},800);else $(e+" .loading-more").hide()},buildUrl:function(e){var n="";return $.each(e,function(e,o){n+=e+"="+encodeURIComponent(o)+"&"}),n},reportEvent:function(e,n,o,t,a,i,r){var d="";try{d=location.href}catch(c){d=document.URL}var p=document.referrer,l=d;o&&(p=d,l=o);var m="";i&&i.openid&&(m=i.openid);var u=0;i&&i.userId&&(u=i.userId);var s=0;i&&"1"==i.encodeOpenId&&(s=i.encodeOpenId);var g=0;i&&"1"==i.encodeQQ&&(g=i.encodeQQ);var f=["ingame","mobile","syb"],h="mobile";r&&-1!=f.indexOf(r)&&(h=r),$.ajax({url:"/login/analysis",type:"POST",data:{mid:e,eid:n,surl:p,durl:l,qq:a||"",openid:m||"",game:t||"bangbang",bd:0,qid:3,aid:u||0,from:h,ref:"",encodeOpenId:s,encodeQQ:g},success:function(){}})},getStatic:function(e,n,o,t){1!=o&&comFun.reportEvent(8,8011,"",e,n,t),comFun.jsLoader([{src:location.protocol+"//js.aq.qq.com/js/aq_common.js",callback:function(){}}])},jsLoader:function(e){for(var n=document.getElementsByTagName("HEAD").item(0),o=0,t=e.length;t>o;++o){var a=document.createElement("script");a.type="text/javascript",a.onload=a.onreadystatechange=function(n){return function(){if(!this.readyState||"loaded"==this.readyState||"complete"==this.readyState){var o=e[n].callback;"function"==typeof o&&o()}}}(o),a.src=e[o].src,n.appendChild(a)}},weixinshare:function(e,n,o,t,a){function i(){WeixinJSBridge.invoke("sendAppMessage",{appid:a,img_url:n,img_width:"50",img_height:"50",link:e,desc:t,title:o},function(){})}function r(){WeixinJSBridge.invoke("shareTimeline",{img_url:n,img_width:"200",img_height:"200",link:e,desc:t,title:o},function(){})}function d(){WeixinJSBridge.invoke("shareWeibo",{content:t,url:e},function(){})}document.addEventListener("WeixinJSBridgeReady",function(){WeixinJSBridge.on("menu:share:appmessage",function(){i()}),WeixinJSBridge.on("menu:share:timeline",function(){r()}),WeixinJSBridge.on("menu:share:weibo",function(){d()})},!1)},undefineToDefault:function(e,n){return void 0==e||0==e?n:e},getPageSwapValue:function(){return window.localStorage.bangpageswap},setPageSwapValue:function(e){window.localStorage.bangpageswap=e},replaceTemplateFromData:function(e,n){var o=e,t=/\{[^{}]*}/g,a=o.match(t),i="",r="",d="";if("object"==typeof n)if(n instanceof Array);else if(n instanceof Object)for(var c in a)i=a[c],r=i.substring(1,i.length-1),d=n[r],o=o.replace(i,d);else console.error("type error");else console.error("undefined"!=typeof n?"type error":"type error");return o},autoHttpType:function(e){return e?e.replace(/http:\/\/|https:\/\//g,location.protocol+"//"):e},autoHttpImg:function(e){return e?(e=-1==e.indexOf(location.protocol)?location.protocol+"//shp.qpic.cn/tgos/"+e.replace(".","/")+"/0":e,e.replace(/http:\/\/|https:\/\//g,location.protocol+"//")):e}};comFun.test=function(){alert("aa")},comFun.appAjaxEncode=function(e,n,o){if(!e||!n)return!1;if("undefined"!=typeof GameHelper&&GameHelper.postEncrypt){var t=$.param(n),a=5e3,i="appCallback"+(new Date).getTime();return window[i]=function(e){var n=!1;if("ios"!=comFun.getSystem()&&GameHelper.getAppVersionName&&GameHelper.getAppVersionCode&&parseInt(GameHelper.getAppVersionCode())>=17080801){var t=GameHelper.getAppVersionName(),a=t.indexOf(".");if(parseFloat(t.substring(0,a+2))>=2.2){var i=new comFun.Base64;e=i.decode(e,!0)}}else"ios"==comFun.getSystem()&&GameHelper.getAppVersionName&&GameHelper.getAppVersionCode&&GameHelper.getAppVersionName(function(t){GameHelper.getAppVersionCode(function(a){var i=t,r=t.indexOf(".");if(-1==r&&(i=a,a=t,r=i.indexOf(".")),parseFloat(i.substring(0,r+2))>=2.2&&parseInt(a)>=17081503){n=!0;var d=new comFun.Base64;e=d.decode(e),o&&o(e)}})});("ios"!=comFun.getSystem()||0==n)&&o&&o(e)},void GameHelper.postEncrypt(e,t,i,a)}comFun.sendAjax(e,n,o)},comFun.sendAjax=function(e,n,o){return e&&n?void $.ajax({url:e,type:"POST",dataType:"json",data:n,success:function(e){o&&o(e)}}):!1},comFun.getSystem=function(){var e=navigator.userAgent.toLowerCase();return/iphone|ipad|ipod|mac/.test(e)?"ios":/android/.test(e)?"android":void 0},comFun.createBanner=function(e,n,o,t,a){if("undefined"==typeof GameHelper){var i=".down-iframe{ width:100%; height:100px;position:fixed; bottom:0; left:0; z-index:999;}    .down-iframe iframe{ width:100%; height:100px;}",r='<div class="down-iframe">        <iframe src="//yoyo.qq.com/web/download.html?cGameId={cGameId}&cSystem={cSystem}&cChannelId={cChannelId}&url={target}&action={action}&gameId={gameId}" allowtransparency="true" frameborder="0"></iframe>    </div>',d=document.head||document.getElementsByTagName("head")[0],c=document.createElement("style");c.appendChild(document.createTextNode(i)),d.appendChild(c),document.domain="qq.com";var p=/iPhone|iPod|iPad/i.test(navigator.userAgent);r=r.replace("{cGameId}",e).replace("{cChannelId}",n).replace("{action}",t).replace("{gameId}",a).replace("{cSystem}",p?"ios":"android").replace(/{target}/g,encodeURIComponent(o)),$("body").append(r)}},comFun.getUrlParam=function(e){var n,o,t,a=new Array;if(e=e.toLowerCase(),n=window.location.href,o=n.indexOf("?"),t=n.substring(o+1),o>0){t=t.split("#")[0],t=t.replace(/\?/g,"&"),a=t.split("&");for(var i=a.length-1;i>=0;i--){var r=new Array;if(r=a[i].split("="),r[0].toLowerCase()==e)return comFun.htmlEncode(r[1])}}return""},comFun.amsLogin=function(e,n){if(milo){var o=comFun.getUrlParam("platid"),t={sServiceType:"bb",acctype:comFun.getUrlParam("acctype"),sArea:comFun.getUrlParam("areaid"),sPartition:comFun.getUrlParam("serverid"),sRoleId:comFun.getUrlParam("roleId"),sAreaName:comFun.getUrlParam("areaName"),sRoleName:comFun.getUrlParam("roleName"),sPlatId:isNaN(o)?"ios"==comFun.getSystem()?0:1:o},a=t.acctype,i=e?e:"IEG_GPCD_CF_APP_OPENID",r=comFun.getUrlParam("game_appid"),d=comFun.getUrlParam("appid"),c=comFun.getUrlParam("uin"),p=comFun.getUrlParam("openkey");if(t.sArea<0)return void(n&&alert("大区不存在"+t.sArea));if("wx"==a){if(milo.cookie.set("lg_source",i,864e3,"qq.com","/"),milo.cookie.set("ams_game_appid",r,864e3,"qq.com","/"),t.appid=d?d:"wxecd607830cdbb9d9",t.iUin=comFun.getUrlParam("openid"),""==t.iUin)return void(n&&alert("角色不存在"))}else{if("qq"!=a)return void(n&&alert("acctype客户端来源参数错误"));if(isNaN(c))return void(n&&alert("请传qq参数"));var l={};if(l.userUin=c,l.nickName=comFun.getUrlParam("roleName"),l.userLoginTime=Math.floor((new Date).getTime()/1e3),milo.cookie.set("IED_LOG_INFO2",milo.serialize(l),864e3,"qq.com","/"),t.appid=r?r:"1104512706",t.openkey=p,""==t.openkey)return void(n&&alert("角色不存在"))}return t}alert("请先加载milojs 后加载commonjs")},comFun.htmlEncode=function(e){var n={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"," ":"&nbsp;"},o=function(e,n){var o=[];for(var t in e)o.push(n?e[t]:t);return o},t=new RegExp("["+o(n).join("")+"]","g");return null==e?"":(""+e).replace(t,function(e){return n[e]})},comFun.setTimingRpt=function(e,n,o,t){var a,i,r,d=window.webkitPerformance?window.webkitPerformance:window.msPerformance,c=["navigationStart","unloadEventStart","unloadEventEnd","redirectStart","redirectEnd","fetchStart","domainLookupStart","domainLookupEnd","connectStart","connectEnd","requestStart","responseStart","responseEnd","domLoading","domInteractive","domContentLoadedEventStart","domContentLoadedEventEnd","domComplete","loadEventStart","loadEventEnd"],p=[],l=o;if(d=d?d:window.performance,d&&(a=d.timing)){a.domContentLoadedEventStart?t&&(l=t):c.splice(15,2,"domContentLoaded","domContentLoaded"),i=a[c[0]];for(var m=1,u=c.length;u>m;m++)r=a[c[m]],r=r?r-i:0,r>0&&p.push(m+"="+r);var s="//isdspeed.qq.com/cgi-bin/r.cgi?flag1="+e+"&flag2="+n+"&flag3="+l+"&"+p.join("&"),g=new Image;setTimeout(function(){g.src=s},0)}comFun.listSortBy=function(e,n,o){o="asc"==o?"asc":"desc";for(var t,a=[],i=[],r=0;r<e.length;r++)a[r]=e[r][n]+":"+r;for(a.sort(function(e,n){return parseFloat(e.split(":")[0])>parseFloat(n.split(":")[0])?1:-1}),"desc"==o&&a.reverse(function(e,n){return parseFloat(e.split(":")[0])>parseFloat(n.split(":")[0])?1:-1}),r=0;r<a.length;r++)t=a[r].split(":")[1],i[r]=e[t];return i}},comFun.Base64=function(){_keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",this.encode=function(e,n){var o,t,a,i,r,d,c,p="",l=0;for(e=_utf8_encode(e);l<e.length;)o=e.charCodeAt(l++),t=e.charCodeAt(l++),a=e.charCodeAt(l++),i=o>>2,r=(3&o)<<4|t>>4,d=(15&t)<<2|a>>6,c=63&a,isNaN(t)?d=c=64:isNaN(a)&&(c=64),p=p+_keyStr.charAt(i)+_keyStr.charAt(r)+_keyStr.charAt(d)+_keyStr.charAt(c);return 1==n&&(p=p.replace(/\+/g,"-").replace(/\//g,"_")),p},this.decode=function(e,n){1==n&&(e=e.replace(/-/g,"+").replace(/_/g,"/"));var o,t,a,i,r,d,c,p="",l=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");l<e.length;)i=_keyStr.indexOf(e.charAt(l++)),r=_keyStr.indexOf(e.charAt(l++)),d=_keyStr.indexOf(e.charAt(l++)),c=_keyStr.indexOf(e.charAt(l++)),o=i<<2|r>>4,t=(15&r)<<4|d>>2,a=(3&d)<<6|c,p+=String.fromCharCode(o),64!=d&&(p+=String.fromCharCode(t)),64!=c&&(p+=String.fromCharCode(a));return p=_utf8_decode(p)},_utf8_encode=function(e){e=e.replace(/\r\n/g,"\n");for(var n="",o=0;o<e.length;o++){var t=e.charCodeAt(o);128>t?n+=String.fromCharCode(t):t>127&&2048>t?(n+=String.fromCharCode(t>>6|192),n+=String.fromCharCode(63&t|128)):(n+=String.fromCharCode(t>>12|224),n+=String.fromCharCode(t>>6&63|128),n+=String.fromCharCode(63&t|128))}return n},_utf8_decode=function(e){for(var n="",o=0,t=c1=c2=0;o<e.length;)t=e.charCodeAt(o),128>t?(n+=String.fromCharCode(t),o++):t>191&&224>t?(c2=e.charCodeAt(o+1),n+=String.fromCharCode((31&t)<<6|63&c2),o+=2):(c2=e.charCodeAt(o+1),c3=e.charCodeAt(o+2),n+=String.fromCharCode((15&t)<<12|(63&c2)<<6|63&c3),o+=3);return n}},comFun.gameHelperShare=function(e,n,o,t,a){if("undefined"!=typeof GameHelper){var i=/iPhone|iPod|iPad/i.test(navigator.userAgent);if(i){if("undefined"!=typeof GameHelper.shareWebPageWithFuntion)return void GameHelper.shareWebPageWithFuntion(o,t,n,e,a,0);if("undefined"!=typeof GameHelper.shareWebPage)return void GameHelper.shareWebPage(o,t,n,e,a,0)}else if("undefined"!=typeof GameHelper.shareWebPageDIY)return void GameHelper.shareWebPageDIY(t,o,n,e,a,1)}else console.log("分享页面")};